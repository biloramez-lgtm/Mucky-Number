name: Android Build Final Fix

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # يتيح لك تشغيل الأكشن يدوياً للتجربة

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Locate Gradlew File (Debug)
        run: |
          echo "Listing all files to find gradlew..."
          find . -name "gradlew"
          
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Fix and Run Build
        run: |
          # البحث عن الملف وتخزين مساره في متغير
          GRADLEW_PATH=$(find . -name "gradlew" | head -n 1)
          
          if [ -z "$GRADLEW_PATH" ]; then
            echo "Error: gradlew file not found anywhere in the repository!"
            exit 1
          fi
          
          echo "Found gradlew at: $GRADLEW_PATH"
          
          # تنظيف نهايات الأسطر ومنح الصلاحيات
          sed -i 's/\r$//' "$GRADLEW_PATH"
          chmod +x "$GRADLEW_PATH"
          
          # تشغيل البناء من المسار الذي وجدناه فيه
          DIR_PATH=$(dirname "$GRADLEW_PATH")
          cd "$DIR_PATH" && ./gradlew bundleRelease
